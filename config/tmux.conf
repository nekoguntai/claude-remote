# Claude Remote - tmux configuration
# Optimized for persistent remote sessions

# ====================
# General Settings
# ====================

# Use Ctrl+a as prefix (easier to reach than Ctrl+b)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Enable mouse support (scrolling, clicking, resizing)
set -g mouse on

# Scrollback buffer - balance between usability and security
# Larger buffers retain more sensitive data in memory
set -g history-limit 10000

# Start window numbering at 1
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Don't rename windows automatically
set -g allow-rename off

# Faster command sequences (reduce escape time)
set -s escape-time 10

# Increase repeat time for repeatable commands
set -g repeat-time 1000

# Enable focus events (useful for vim/neovim)
set -g focus-events on

# 256 color support
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",*256col*:Tc"

# ====================
# Idle Screen Lock (Cosmetic)
# ====================

# NOTE: This is NOT a security feature. The lock screen simply clears the
# display and requires pressing Enter to continue. It does NOT require a
# password. For actual security, rely on:
# - Tailscale authentication (2FA recommended)
# - Web terminal password
# - SSH key authentication
# - Physical device security

# Lock screen after 15 minutes of inactivity (clears display)
set -g lock-after-time 900
set -g lock-command "clear && echo 'Session idle - press Enter to continue'"

# Bind L to manually trigger idle screen
bind L lock-session

# ====================
# Status Bar
# ====================

# Update status bar every 5 seconds
set -g status-interval 5

# Status bar position
set -g status-position bottom

# Status bar colors
set -g status-style 'bg=#1e1e2e fg=#cdd6f4'

# Left side: session name
set -g status-left-length 40
set -g status-left '#[fg=#1e1e2e,bg=#89b4fa,bold] #S #[fg=#89b4fa,bg=#1e1e2e]'

# Right side: host, date, time
set -g status-right-length 60
set -g status-right '#[fg=#45475a]#[fg=#cdd6f4,bg=#45475a] #H #[fg=#89b4fa]#[fg=#1e1e2e,bg=#89b4fa,bold] %Y-%m-%d %H:%M '

# Window status
setw -g window-status-format ' #I:#W '
setw -g window-status-current-format '#[fg=#1e1e2e,bg=#a6e3a1,bold] #I:#W #[fg=#a6e3a1,bg=#1e1e2e]'

# ====================
# Key Bindings
# ====================

# Reload config
bind r source-file ~/.tmux.conf \; display-message "Config reloaded!"

# Split panes using | and -
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Navigate panes with vim keys
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Resize panes with vim keys (repeatable)
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# New window in current path
bind c new-window -c "#{pane_current_path}"

# Quick window switching
bind -r C-h previous-window
bind -r C-l next-window

# Synchronize panes toggle
bind S setw synchronize-panes

# Clear scrollback buffer (security - removes sensitive output)
bind C-k clear-history \; display-message "Scrollback cleared"

# ====================
# Copy Mode (vim-style)
# ====================

setw -g mode-keys vi

# Enter copy mode with prefix + [
bind [ copy-mode

# Vim-style copy mode bindings
bind -T copy-mode-vi v send-keys -X begin-selection
bind -T copy-mode-vi y send-keys -X copy-selection-and-cancel
bind -T copy-mode-vi r send-keys -X rectangle-toggle

# ====================
# Session Persistence
# ====================

# These settings help with session recovery
# For full persistence across reboots, consider tmux-resurrect plugin

# Activity monitoring
setw -g monitor-activity on
set -g visual-activity off

# Don't exit tmux when closing a session
set -g detach-on-destroy off

# ====================
# Pane Settings
# ====================

# Pane border colors
set -g pane-border-style 'fg=#45475a'
set -g pane-active-border-style 'fg=#89b4fa'

# Display pane numbers longer
set -g display-panes-time 2000

# ====================
# Message Settings
# ====================

set -g message-style 'fg=#1e1e2e bg=#f9e2af bold'
set -g message-command-style 'fg=#1e1e2e bg=#f9e2af'
